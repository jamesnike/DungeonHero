@tailwind base;
@tailwind components;
@tailwind utilities;

/* LIGHT MODE */
:root {
  --button-outline: rgba(0,0,0, .10);
  --badge-outline: rgba(0,0,0, .05);
  --opaque-button-border-intensity: -8;
  --elevate-1: rgba(0,0,0, .03);
  --elevate-2: rgba(0,0,0, .08);
  --background: 0 0% 100%;
  --foreground: 0 0% 9%;
  --border: 0 0% 91%;
  --card: 0 0% 98%;
  --card-foreground: 0 0% 9%;
  --card-border: 0 0% 94%;
  --sidebar: 0 0% 96%;
  --sidebar-foreground: 0 0% 9%;
  --sidebar-border: 0 0% 92%;
  --sidebar-primary: 271 91% 35%;
  --sidebar-primary-foreground: 271 91% 98%;
  --sidebar-accent: 0 0% 92%;
  --sidebar-accent-foreground: 0 0% 9%;
  --sidebar-ring: 271 91% 35%;
  --popover: 0 0% 95%;
  --popover-foreground: 0 0% 9%;
  --popover-border: 0 0% 91%;
  --primary: 271 91% 35%;
  --primary-foreground: 271 91% 98%;
  --secondary: 0 0% 90%;
  --secondary-foreground: 0 0% 9%;
  --muted: 0 4% 93%;
  --muted-foreground: 0 4% 35%;
  --accent: 271 15% 92%;
  --accent-foreground: 271 15% 15%;
  --destructive: 0 84% 37%;
  --destructive-foreground: 0 84% 98%;
  --input: 0 0% 80%;
  --ring: 271 91% 35%;
  --chart-1: 271 91% 35%;
  --chart-2: 198 75% 38%;
  --chart-3: 43 96% 42%;
  --chart-4: 27 87% 40%;
  --chart-5: 142 76% 36%;
  --font-sans: Lato, sans-serif;
  --font-serif: Cinzel, serif;
  --font-mono: 'Roboto Mono', monospace;
  --radius: .5rem;
  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --dh-grid-gap-x: 20px;
  --dh-grid-gap-y: 16px;
  --dh-card-padding: 6px;
  --dh-card-font-scale: 1;
  --dh-card-stat-scale: 1;
  --dh-card-icon-scale: 1;
  --dh-card-dot-size: 7px;
  --dh-card-instance-scale: 1;
  --dh-hero-font-scale: 1;
  --dh-hero-instance-scale: 1;
  --dh-dice-instance-scale: 1;
  --dh-overlay-scale: 1;
  --dh-combat-panel-scale: 1;
  --dh-rage-strip-width: 12px;
  --tracking-normal: 0em;
  --spacing: 0.25rem;
  --dh-grid-gap-x: 20px;
  --dh-grid-gap-y: 16px;
  --dh-card-padding: 6px;
  --dh-card-font-scale: 1;
  --dh-card-stat-scale: 1;
  --dh-card-icon-scale: 1;
  --dh-card-dot-size: 7px;
  --dh-card-instance-scale: 1;
  --dh-hero-font-scale: 1;
  --dh-hero-instance-scale: 1;
  --dh-dice-instance-scale: 1;
  --dh-overlay-scale: 1;
  --dh-combat-panel-scale: 1;

/* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

.dark {
  --button-outline: rgba(255,255,255, .10);
  --badge-outline: rgba(255,255,255, .05);
  --opaque-button-border-intensity: 9;
  --elevate-1: rgba(255,255,255, .04);
  --elevate-2: rgba(255,255,255, .09);
  --background: 0 0% 7%;
  --foreground: 0 0% 95%;
  --border: 0 0% 16%;
  --card: 0 0% 9%;
  --card-foreground: 0 0% 95%;
  --card-border: 0 0% 12%;
  --sidebar: 0 0% 11%;
  --sidebar-foreground: 0 0% 95%;
  --sidebar-border: 0 0% 14%;
  --sidebar-primary: 271 91% 35%;
  --sidebar-primary-foreground: 271 91% 98%;
  --sidebar-accent: 0 0% 14%;
  --sidebar-accent-foreground: 0 0% 95%;
  --sidebar-ring: 271 91% 35%;
  --popover: 0 0% 13%;
  --popover-foreground: 0 0% 95%;
  --popover-border: 0 0% 16%;
  --primary: 271 91% 35%;
  --primary-foreground: 271 91% 98%;
  --secondary: 0 0% 16%;
  --secondary-foreground: 0 0% 95%;
  --muted: 0 4% 15%;
  --muted-foreground: 0 4% 75%;
  --accent: 271 15% 14%;
  --accent-foreground: 271 15% 92%;
  --destructive: 0 84% 35%;
  --destructive-foreground: 0 84% 98%;
  --input: 0 0% 25%;
  --ring: 271 91% 35%;
  --chart-1: 271 75% 65%;
  --chart-2: 198 75% 65%;
  --chart-3: 43 85% 68%;
  --chart-4: 27 87% 68%;
  --chart-5: 142 70% 65%;
  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 1px 2px -1px hsl(0 0% 0% / 0.00);
  --shadow-md: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 2px 4px -1px hsl(0 0% 0% / 0.00);
  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 4px 6px -1px hsl(0 0% 0% / 0.00);
  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00), 0px 8px 10px -1px hsl(0 0% 0% / 0.00);
  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 0% / 0.00);
  --dh-rage-strip-width: 12px;

/* Fallback for older browsers */
  --sidebar-primary-border: hsl(var(--sidebar-primary));
  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --sidebar-accent-border: hsl(var(--sidebar-accent));
  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --primary-border: hsl(var(--primary));
  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --secondary-border: hsl(var(--secondary));
  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --muted-border: hsl(var(--muted));
  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --accent-border: hsl(var(--accent));
  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);

  /* Fallback for older browsers */
  --destructive-border: hsl(var(--destructive));
  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply font-sans antialiased bg-background text-foreground;
  }
}

/**
 * Using the elevate system.
 * Automatic contrast adjustment.
 *
 * <element className="hover-elevate" />
 * <element className="active-elevate-2" />
 *
 * // Using the tailwind utility when a data attribute is "on"
 * <element className="toggle-elevate data-[state=on]:toggle-elevated" />
 * // Or manually controlling the toggle state
 * <element className="toggle-elevate toggle-elevated" />
 *
 * Elevation systems have to handle many states.
 * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)
 * - toggled or not
 * - focused or not (this is not handled with these utilities)
 *
 * Even without handling focused or not, this is six possible combinations that
 * need to be distinguished from eachother visually.
 */
@layer utilities {
  /* Card animations */
  @keyframes card-remove {
    0% {
      opacity: 1;
      transform: scale(1) rotate(0deg);
    }
    50% {
      opacity: 0.5;
      transform: scale(1.1) rotate(5deg);
    }
    100% {
      opacity: 0;
      transform: scale(0.8) rotate(10deg) translateY(-20px);
    }
  }
  
  @keyframes damage-flash {
    0%, 100% {
      background-color: transparent;
    }
    50% {
      background-color: rgba(220, 38, 38, 0.3);
    }
  }
  
  @keyframes heal-glow {
    0%, 100% {
      box-shadow: 0 0 0 rgba(34, 197, 94, 0);
    }
    50% {
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.6);
    }
  }
  
  @keyframes bleed-splatter {
    0% {
      opacity: 0;
      transform: scale(0.35) rotate(-8deg);
      filter: blur(0px);
    }
    35% {
      opacity: 0.95;
      transform: scale(1) rotate(2deg);
      filter: blur(0px);
    }
    65% {
      opacity: 0.85;
      transform: scale(1.15) rotate(6deg);
    }
    100% {
      opacity: 0;
      transform: scale(1.4) rotate(10deg);
      filter: blur(1.5px);
    }
  }

  @keyframes weapon-swing {
    0% {
      opacity: 0;
      transform: rotate(-48deg) translateX(-65%);
    }
    20% {
      opacity: 0.9;
      transform: rotate(-12deg) translateX(-10%);
    }
    55% {
      opacity: 1;
      transform: rotate(6deg) translateX(25%);
    }
    100% {
      opacity: 0;
      transform: rotate(52deg) translateX(70%);
    }
  }

  @keyframes shield-block {
    0% {
      opacity: 0;
      transform: scale(0.45);
      box-shadow: 0 0 0 rgba(59, 130, 246, 0.15);
    }
    40% {
      opacity: 0.9;
      transform: scale(0.95);
      box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
    }
    70% {
      opacity: 0.85;
      transform: scale(1.2);
      box-shadow: 0 0 40px rgba(96, 165, 250, 0.35);
    }
    100% {
      opacity: 0;
      transform: scale(1.5);
      box-shadow: 0 0 0 rgba(59, 130, 246, 0);
    }
  }

  .animate-card-remove {
    animation: card-remove 300ms ease-out forwards;
  }
  
  .animate-damage-flash {
    animation: damage-flash 200ms ease-out;
  }
  
  .animate-heal-glow {
    animation: heal-glow 500ms ease-out;
  }

  :root {
    --combat-animation-stagger: 160ms;
  }

  .combat-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    z-index: 40;
  }

  .combat-overlay__shape {
    display: block;
    pointer-events: none;
    will-change: transform, opacity;
  }

  .combat-overlay__shape[data-stagger="1"] {
    animation-delay: var(--combat-animation-stagger, 160ms);
  }

  .combat-overlay__shape[data-stagger="2"] {
    animation-delay: calc(var(--combat-animation-stagger, 160ms) * 2);
  }

  @keyframes bleed-drip {
    0% {
      opacity: 0;
      transform: translateY(-20%) scaleY(0.2);
    }
    30% {
      opacity: 0.8;
      transform: translateY(10%) scaleY(1);
    }
    60% {
      opacity: 0.9;
      transform: translateY(35%) scaleY(1.15);
    }
    100% {
      opacity: 0;
      transform: translateY(70%) scaleY(0.7);
    }
  }

  @keyframes bleed-ring {
    0% {
      opacity: 0.4;
      transform: scale(0.6);
    }
    50% {
      opacity: 0.8;
      transform: scale(1);
    }
    100% {
      opacity: 0;
      transform: scale(1.4);
    }
  }

  .combat-overlay__shape--bleed {
    width: 70%;
    aspect-ratio: 1 / 1;
    background: radial-gradient(circle at 30% 30%, rgba(248, 113, 113, 0.9), rgba(153, 27, 27, 0.8));
    border-radius: 50%;
    mix-blend-mode: multiply;
    animation: bleed-splatter 1100ms cubic-bezier(0.25, 0.9, 0.3, 1) forwards;
    filter: drop-shadow(0 0 12px rgba(153, 27, 27, 0.45));
  }

  .combat-overlay__shape--swing {
    width: 75%;
    height: 10px;
    border-radius: 999px;
    background: linear-gradient(90deg, transparent, rgba(250, 204, 21, 0.9), rgba(251, 191, 36, 0.4), transparent);
    animation: weapon-swing 900ms cubic-bezier(0.2, 0.85, 0.25, 1) forwards;
  }

  @keyframes weapon-echo {
    0% {
      opacity: 0;
      transform: rotate(-35deg) translateX(-40%);
    }
    25% {
      opacity: 0.8;
    }
    100% {
      opacity: 0;
      transform: rotate(35deg) translateX(50%);
    }
  }

  @keyframes weapon-spark {
    0% {
      opacity: 0;
      transform: scale(0.5);
    }
    30% {
      opacity: 1;
      transform: scale(1.1);
    }
    100% {
      opacity: 0;
      transform: scale(1.4);
    }
  }

  .combat-overlay__shape--block {
    width: 65%;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    border: 4px solid rgba(59, 130, 246, 0.8);
    background: radial-gradient(circle, rgba(59, 130, 246, 0.25), transparent 65%);
    animation: shield-block 1000ms cubic-bezier(0.2, 0.85, 0.25, 1) forwards;
  }

  @keyframes shield-ripple {
    0% {
      opacity: 0.7;
      transform: scale(0.6);
      border-width: 2px;
    }
    50% {
      opacity: 0.4;
      transform: scale(1.1);
    }
    100% {
      opacity: 0;
      transform: scale(1.6);
      border-width: 1px;
    }
  }

  @keyframes shield-spark {
    0% {
      opacity: 0;
      transform: scale(0.4) rotate(0deg);
    }
    50% {
      opacity: 0.8;
      transform: scale(1) rotate(8deg);
    }
    100% {
      opacity: 0;
      transform: scale(1.3) rotate(18deg);
    }
  }

  .combat-overlay__shape--bleed-drip {
    position: absolute;
    width: 12%;
    height: 55%;
    border-radius: 999px;
    background: linear-gradient(180deg, rgba(255, 152, 152, 0.9), rgba(190, 24, 93, 0.7));
    animation: bleed-drip 1200ms cubic-bezier(0.33, 1, 0.68, 1) forwards;
    filter: drop-shadow(0 4px 6px rgba(153, 27, 27, 0.35));
  }

  .combat-overlay__shape--bleed-ring {
    width: 85%;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    border: 2px solid rgba(248, 113, 113, 0.4);
    animation: bleed-ring 1250ms cubic-bezier(0.33, 1, 0.68, 1) forwards;
  }

  .combat-overlay__shape--swing-echo {
    width: 85%;
    height: 6px;
    border-radius: 999px;
    background: linear-gradient(90deg, transparent, rgba(251, 191, 36, 0.5), transparent);
    animation: weapon-echo 1050ms cubic-bezier(0.22, 0.9, 0.32, 1) forwards;
  }

  .combat-overlay__shape--swing-spark {
    width: 20%;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(252, 211, 77, 0.8), transparent 60%);
    animation: weapon-spark 800ms cubic-bezier(0.42, 0, 0.58, 1) forwards;
  }

  .combat-overlay[data-swing-variant="1"] .combat-overlay__shape--swing,
  .combat-overlay[data-swing-variant="1"] .combat-overlay__shape--swing-echo {
    animation-direction: reverse;
  }

  .combat-overlay[data-swing-variant="1"] .combat-overlay__shape--swing-spark {
    animation-delay: calc(var(--combat-animation-stagger, 160ms) * 0.5);
  }

  .combat-overlay__shape--block-ripple {
    width: 75%;
    aspect-ratio: 1 / 1;
    border-radius: 50%;
    border: 2px solid rgba(147, 197, 253, 0.6);
    animation: shield-ripple 1250ms cubic-bezier(0.33, 1, 0.68, 1) forwards;
  }

  .combat-overlay__shape--block-spark {
    width: 18%;
    aspect-ratio: 1 / 1;
    border-radius: 999px;
    background: radial-gradient(circle, rgba(191, 219, 254, 0.9), transparent 65%);
    animation: shield-spark 950ms cubic-bezier(0.42, 0, 0.58, 1) forwards;
    box-shadow: 0 0 14px rgba(191, 219, 254, 0.5);
  }

  .combat-overlay[data-block-variant="1"] .combat-overlay__shape--block {
    animation-delay: calc(var(--combat-animation-stagger, 160ms) * 0.5);
  }

  .combat-overlay[data-block-variant="1"] .combat-overlay__shape--block-ripple {
    animation-delay: calc(var(--combat-animation-stagger, 160ms) * 1.25);
  }

  .engaged-monster {
    position: relative;
  }

  .engaged-monster .shadcn-card {
    position: relative;
  }

  .engaged-monster .shadcn-card::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    background: linear-gradient(145deg, rgba(248, 113, 113, 0.2), rgba(190, 24, 93, 0.25));
    box-shadow: inset 0 0 25px rgba(190, 24, 93, 0.35);
    opacity: 0.85;
    pointer-events: none;
    mix-blend-mode: multiply;
    z-index: 5;
    transition: opacity 200ms ease;
  }

  .engaged-monster:hover .shadcn-card::after {
    opacity: 0.95;
  }

.monster-target-highlight {
  border-radius: 1.35rem;
  box-shadow:
    0 0 0 3px rgba(251, 191, 36, 0.85),
    0 0 18px rgba(251, 191, 36, 0.5);
}

  @keyframes preview-drop {
    0% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translateY(115%) scale(0.95);
      opacity: 0;
    }
  }

  .animate-preview-drop {
    animation: preview-drop 650ms ease-in forwards;
    pointer-events: none;
  }

  @keyframes preview-graveyard {
    0% {
      transform: translate(0, 0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translate(var(--graveyard-offset-x, 70px), var(--graveyard-offset-y, 140px)) scale(0.6);
      opacity: 0;
    }
  }

  .animate-preview-graveyard {
    animation: preview-graveyard 450ms ease-in forwards;
    pointer-events: none;
  }

  @keyframes active-landing {
    0% {
      transform: translateY(-35%) scale(0.9);
      opacity: 0;
    }
    100% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }

  .animate-active-landing {
    animation: active-landing 450ms ease-out;
  }

  @keyframes preview-deal {
    0% {
      transform: translateY(-25%) scale(0.85);
      opacity: 0;
    }
    100% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
  }

  .animate-preview-deal {
    animation: preview-deal 550ms ease-out;
  }

  .class-flight-card {
    pointer-events: none;
    will-change: transform, opacity;
    filter: drop-shadow(0 10px 18px rgba(15, 23, 42, 0.45));
    transition: opacity 220ms cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  @keyframes modal-fade-in {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes modal-slide-in {
    from {
      opacity: 0;
      transform: translateY(-30px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }
  
  .animate-modal-fade-in {
    animation: modal-fade-in 200ms ease-out;
  }
  
  .animate-modal-slide-in {
    animation: modal-slide-in 400ms ease-out;
  }

  /* Hide ugly search cancel button in Chrome until we can style it properly */
  input[type="search"]::-webkit-search-cancel-button {
    @apply hidden;
  }

  /* Placeholder styling for contentEditable div */
  [contenteditable][data-placeholder]:empty::before {
    content: attr(data-placeholder);
    color: hsl(var(--muted-foreground));
    pointer-events: none;
  }

  .game-grid {
    grid-template-columns: repeat(6, minmax(0, 1fr));
    grid-template-rows: repeat(3, minmax(0, 1fr));
    gap: var(--dh-grid-gap-y, 0.5rem) var(--dh-grid-gap-x, 0.5rem);
  }

  .dh-grid-cell {
    padding: var(--dh-card-padding, 0.25rem);
  }

  .dh-card-wrapper {
    --dh-card-title-base: clamp(0.72rem, 0.6rem + 0.8vw, 1rem);
    --dh-card-body-base: clamp(0.6rem, 0.5rem + 0.5vw, 0.9rem);
    --dh-card-stat-base: clamp(1rem, 0.85rem + 0.8vw, 1.5rem);
    --dh-card-icon-base: clamp(1.05rem, 0.9rem + 0.5vw, 1.4rem);
    font-size: calc(
      var(--dh-card-body-base) *
      var(--dh-card-font-scale, 1) *
      var(--dh-card-instance-scale, 1)
    );
  }

  .dh-card__name {
    font-size: calc(
      var(--dh-card-title-base) *
      var(--dh-card-font-scale, 1) *
      var(--dh-card-instance-scale, 1)
    );
    line-height: 1.15;
  }

  .dh-card__body-text {
    font-size: calc(
      var(--dh-card-body-base) *
      var(--dh-card-font-scale, 1) *
      var(--dh-card-instance-scale, 1)
    );
    line-height: 1.25;
  }

  .dh-card__caption {
    font-size: calc(
      0.55rem *
      var(--dh-card-font-scale, 1) *
      var(--dh-card-instance-scale, 1)
    );
    line-height: 1.2;
  }

  .dh-card__stat {
    font-size: calc(
      var(--dh-card-stat-base) *
      var(--dh-card-stat-scale, 1) *
      var(--dh-card-instance-scale, 1)
    );
  }

  .dh-card__icon {
    width: calc(
      var(--dh-card-icon-base) *
      var(--dh-card-icon-scale, 1) *
      var(--dh-card-instance-scale, 1)
    );
    height: calc(
      var(--dh-card-icon-base) *
      var(--dh-card-icon-scale, 1) *
      var(--dh-card-instance-scale, 1)
    );
  }

  .dh-card__durability-dot {
    width: calc(var(--dh-card-dot-size, 0.45rem) * var(--dh-card-instance-scale, 1));
    height: calc(var(--dh-card-dot-size, 0.45rem) * var(--dh-card-instance-scale, 1));
  }

  .dh-card__layer-dot {
    width: calc(0.42rem * var(--dh-card-font-scale, 1) * var(--dh-card-instance-scale, 1));
    height: calc(0.42rem * var(--dh-card-font-scale, 1) * var(--dh-card-instance-scale, 1));
  }

  .dh-icon-inline {
    width: calc(0.85rem * var(--dh-card-icon-scale, 1) * var(--dh-card-instance-scale, 1));
    height: calc(0.85rem * var(--dh-card-icon-scale, 1) * var(--dh-card-instance-scale, 1));
  }

  .monster-rage-column,
  .durability-column {
    width: var(--dh-rage-strip-width, 12px);
    font-size: calc(0.7rem * var(--dh-card-font-scale, 1));
  }

  .dh-hero-name {
    font-size: calc(1.05rem * var(--dh-hero-font-scale, 1));
    line-height: 1.1;
  }

  .dh-hero-class {
    font-size: calc(0.78rem * var(--dh-hero-font-scale, 1));
  }

  .dh-hero-chip {
    font-size: calc(
      0.65rem *
      var(--dh-hero-font-scale, 1) *
      var(--dh-hero-instance-scale, 1)
    );
    line-height: 1.2;
  }

  .dh-hero-small {
    font-size: calc(
      0.58rem *
      var(--dh-hero-font-scale, 1) *
      var(--dh-hero-instance-scale, 1)
    );
  }

  .dh-hero-hp {
    --dh-hero-hp-base: clamp(1.05rem, 0.8rem + 1vw, 1.9rem);
    font-size: calc(
      var(--dh-hero-hp-base) *
      var(--dh-hero-font-scale, 1) *
      var(--dh-hero-instance-scale, 1)
    );
  }

  .dh-hero-pill {
    font-size: calc(0.62rem * var(--dh-hero-font-scale, 1));
    line-height: 1.25;
  }

  .dh-hero-icon {
    width: calc(1rem * var(--dh-hero-font-scale, 1) * var(--dh-hero-instance-scale, 1));
    height: calc(1rem * var(--dh-hero-font-scale, 1) * var(--dh-hero-instance-scale, 1));
  }

  .dh-deck-label {
    font-size: calc(0.62rem * var(--dh-hero-font-scale, 1));
  }

  .dh-deck-badge {
    font-size: calc(0.56rem * var(--dh-hero-font-scale, 1));
  }

  .dh-deck-count {
    font-size: calc(0.72rem * var(--dh-hero-font-scale, 1));
  }

  .hero-row-frame {
    position: absolute;
    pointer-events: none;
    border-radius: 1.75rem;
    background-color: hsl(var(--card) / 0.35);
    transition: box-shadow 300ms ease, border-color 300ms ease, outline-color 300ms ease;
  }

  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of
   * buttons/badges can remove the automatic brightness adjustment on interactions
   * and program their own. */
  .no-default-hover-elevate {}

  .no-default-active-elevate {}


  /**
   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.
   * This way they can stack/compound. Both will overlap the parent's borders!
   * So borders will be automatically adjusted both on toggle, and hover/active,
   * and they will be compounded.
   */
  .toggle-elevate::before,
  .toggle-elevate-2::before {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    /*border-radius: inherit;   match rounded corners */
    border-radius: inherit;
    z-index: -1;
    /* sits behind content but above backdrop */
  }

  .toggle-elevate.toggle-elevated::before {
    background-color: var(--elevate-2);
  }

  /* If there's a 1px border, adjust the inset so that it covers that parent's border */
  .border.toggle-elevate::before {
    inset: -1px;
  }

  /* Does not work on elements with overflow:hidden! */
  .hover-elevate:not(.no-default-hover-elevate),
  .active-elevate:not(.no-default-active-elevate),
  .hover-elevate-2:not(.no-default-hover-elevate),
  .active-elevate-2:not(.no-default-active-elevate) {
    position: relative;
    z-index: 0;
  }

  .hover-elevate:not(.no-default-hover-elevate)::after,
  .active-elevate:not(.no-default-active-elevate)::after,
  .hover-elevate-2:not(.no-default-hover-elevate)::after,
  .active-elevate-2:not(.no-default-active-elevate)::after {
    content: "";
    pointer-events: none;
    position: absolute;
    inset: 0px;
    /*border-radius: inherit;   match rounded corners */
    border-radius: inherit;
    z-index: 999;
    /* sits in front of content */
  }

  .hover-elevate:hover:not(.no-default-hover-elevate)::after,
  .active-elevate:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-1);
  }

  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,
  .active-elevate-2:active:not(.no-default-active-elevate)::after {
    background-color: var(--elevate-2);
  }

  /* If there's a 1px border, adjust the inset so that it covers that parent's border */
  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,
  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,
  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {
    inset: -1px;
  }

  .dice-canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  .block-button {
    --overlay-scale: var(--dh-overlay-scale, 1);
    padding: calc(1.25rem * var(--overlay-scale)) calc(1.5rem * var(--overlay-scale));
    border-radius: calc(1.25rem * var(--overlay-scale));
    font-size: calc(1rem * var(--overlay-scale));
    min-width: calc(11rem * var(--overlay-scale));
    gap: calc(0.35rem * var(--overlay-scale));
  }

  .block-button--active {
    background-color: hsl(var(--destructive));
    color: hsl(var(--destructive-foreground));
  }

  .block-button--active:hover:not(:disabled) {
    background-color: hsl(var(--destructive) / 0.9);
  }

  .block-button--disabled {
    background-color: hsl(var(--muted));
    color: hsl(var(--muted-foreground));
    cursor: not-allowed;
    opacity: 0.65;
  }

  .block-button__label {
    font-size: calc(1.1rem * var(--overlay-scale));
    font-weight: 600;
  }

  .block-button__meta {
    font-size: calc(0.85rem * var(--overlay-scale));
    font-weight: 400;
  }

  .equipment-select {
    --overlay-scale: var(--dh-overlay-scale, 1);
  }

  .equipment-select__button {
    transition: transform 150ms ease, opacity 150ms ease;
    padding: calc(0.85rem * var(--overlay-scale));
    border-radius: calc(0.9rem * var(--overlay-scale));
  }

  .equipment-select__button--active:hover {
    transform: translateY(-2px);
  }

  .equipment-select__button--disabled {
    opacity: 0.55;
    cursor: not-allowed;
  }

  .equipment-select__label {
    font-size: calc(0.58rem * var(--overlay-scale));
    letter-spacing: 0.12em;
  }

  .equipment-select__name {
    font-size: calc(0.95rem * var(--overlay-scale));
  }

  .equipment-select__meta {
    font-size: calc(0.7rem * var(--overlay-scale));
  }

  .equipment-select__empty {
    font-size: calc(0.85rem * var(--overlay-scale));
  }

  .equipment-select__cancel {
    font-size: calc(0.85rem * var(--overlay-scale));
  }

  .combat-panel {
    --combat-panel-scale: var(--dh-combat-panel-scale, 1);
  }

  .combat-panel__label {
    font-size: calc(0.5rem * var(--combat-panel-scale, 1));
    letter-spacing: 0.15em;
  }

  .combat-panel__title {
    font-size: calc(0.69rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__summary {
    font-size: calc(0.56rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__icon-ring {
    width: calc(1.5rem * var(--combat-panel-scale, 1));
    height: calc(1.5rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__icon {
    width: calc(0.75rem * var(--combat-panel-scale, 1));
    height: calc(0.75rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__alert {
    font-size: calc(0.69rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__thumb {
    width: calc(2rem * var(--combat-panel-scale, 1));
    height: calc(2.75rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__thumb-fallback {
    font-size: calc(0.44rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__list-name {
    font-size: calc(0.625rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__badge {
    font-size: calc(0.44rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__stat {
    font-size: calc(0.5rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__button {
    font-size: calc(0.625rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__footer-text {
    font-size: calc(0.69rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__slot-label {
    font-size: calc(0.68rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__slot-name {
    font-size: calc(0.8rem * var(--combat-panel-scale, 1));
  }

  .combat-panel__slot-state {
    font-size: calc(0.68rem * var(--combat-panel-scale, 1));
  }
}

.dh-perspective {
  perspective: 1600px;
}

.dh-preserve-3d {
  transform-style: preserve-3d;
}

.dh-backface-hidden {
  backface-visibility: hidden;
}
